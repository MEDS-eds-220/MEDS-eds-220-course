<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>lesson-12-merge-data – EDS 220 - Working with Environmental Datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">EDS 220 - Working with Environmental Datasets</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../week-by-week/week-by-week.html"> 
<span class="menu-text">week by week</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../../book/preface.html" aria-current="page"> 
<span class="menu-text">notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../discussion-sections/discussion-sections-listing.html"> 
<span class="menu-text">discussion sections</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-assignments" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">assignments</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-assignments">    
        <li>
    <a class="dropdown-item" href="../../../assignments/assignment1.html">
 <span class="dropdown-text">assignment 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../assignments/assignment2.html">
 <span class="dropdown-text">assignment 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../assignments/assignment3.html">
 <span class="dropdown-text">assignment 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../assignments/assignment4.html">
 <span class="dropdown-text">assignment 4</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/carmengg/MEDS-eds-220-course">
 <span class="dropdown-text">Source code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/carmengg/MEDS-eds-220-course/issues">
 <span class="dropdown-text">Report a bug</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../book/chapters/lesson-8-crs.html">Vector data</a></li><li class="breadcrumb-item"><a href="../../../book/chapters/lesson-12-merge-data/lesson-12-merge-data.html">11 Reprojecting</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="c7b7782e967bb59a093245536bfed491" class="alert alert-primary hidden"><i class="bi bi-hammer quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p>This wesbite is under construction.</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-1-python-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python review</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Tabular data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-2-series-dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1 <code>pandas</code> series and data frames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-3-pandas-subsetting/lesson-3-pandas-subsetting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2 Subsetting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-4-plotting-pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 Basic plotting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-5-updating-dataframes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4 Updating data frames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-6-groupby.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5 Grouping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/merging-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Merging data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-7-time-series.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6 Time series</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Vector data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-8-crs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7 Coordinate reference systems</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-9-vector-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8 Vector data formats</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-10-geopandas-intro/lesson-10-geopandas-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9 <code>geopandas</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-11-csv-to-geodataframe/lesson-11-csv-to-geo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 Streamline your code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-12-merge-data/lesson-12-merge-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">11 Reprojecting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-13-clipping/lesson-13-clipping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 Clipping</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Multidimensional data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-14-xarray/lesson-14-xarray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13 NetCDF and <code>xarray</code></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Raster data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-15-rioxarray/lesson-15-rioxarray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14 <code>rioxarray</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/chapters/lesson-16-STAC.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">15 STAC specification</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/appendices/comments-guidelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Commenting code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../book/appendices/A-python-environments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conda environments</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#reprojecting" id="toc-reprojecting" class="nav-link active" data-scroll-target="#reprojecting">11 Reprojecting</a>
  <ul class="collapse">
  <li><a href="#about-the-data" id="toc-about-the-data" class="nav-link" data-scroll-target="#about-the-data">About the data</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#arctic-communities-by-country" id="toc-arctic-communities-by-country" class="nav-link" data-scroll-target="#arctic-communities-by-country">Arctic communities by country</a></li>
  <li><a href="#if-else-statements" id="toc-if-else-statements" class="nav-link" data-scroll-target="#if-else-statements"><code>if</code>-<code>else</code> statements</a></li>
  <li><a href="#merging-data-frames" id="toc-merging-data-frames" class="nav-link" data-scroll-target="#merging-data-frames">Merging data frames</a></li>
  <li><a href="#reviewing-results" id="toc-reviewing-results" class="nav-link" data-scroll-target="#reviewing-results">Reviewing results</a></li>
  <li><a href="#choropleth-map" id="toc-choropleth-map" class="nav-link" data-scroll-target="#choropleth-map">Choropleth map</a></li>
  <li><a href="#reprojecting-1" id="toc-reprojecting-1" class="nav-link" data-scroll-target="#reprojecting-1">Reprojecting</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<!--
Ignore ShapelyDeprecationWarning warning in render

::: {#e2561179 .cell execution_count=1}
``` {.python .cell-code}
import shapely
import warnings
from shapely.errors import ShapelyDeprecationWarning

warnings.filterwarnings("ignore", category=ShapelyDeprecationWarning) 
warnings.filterwarnings("ignore", category=FutureWarning)
```
:::


-->
<section id="reprojecting" class="level1">
<h1>11 Reprojecting</h1>
<p>In this section we will learn how to join dataframes and will apply this to creating a <a href="https://en.wikipedia.org/wiki/Choropleth_map">choropleth map</a> with <code>geopandas</code>.</p>
<section id="about-the-data" class="level2">
<h2 class="anchored" data-anchor-id="about-the-data">About the data</h2>
<p>The first dataset we will use is a <a href="https://search.dataone.org/view/doi%3A10.18739%2FA28S4JQ80">list of Arctic communities and their location</a> <span class="citation" data-cites="brook_approximate_2023"><a href="#ref-brook_approximate_2023" role="doc-biblioref">[1]</a></span> created by the <a href="https://www.anthc.org">Alaska Native Tribal Health Consortium</a>. This data comes in a GeoJSON file with the following attributes:</p>
<ul>
<li><strong>name</strong>: name of Arctic community,</li>
<li><strong>population</strong>: population of Arctic community, as of 2022</li>
<li><strong>country</strong>: country that the Arctic community falls within (see dataset metadata for the codes)</li>
<li><strong>geoname-id</strong>: numeric codes that uniquely identify all administrative/legal and statistical geographic areas for which the Census Bureau tabulates data</li>
</ul>
<p>The second dataset is <a href="https://www.naturalearthdata.com/downloads/50m-cultural-vectors/">Natural Earth’s medium-scale cultural boundaries data for countries (1:50m)</a>. We can obtain this dataset by downloading the shapefile. <a href="https://www.naturalearthdata.com">Natural Earth</a> is a public domain dataset with free, ready-to-use data for creating maps.</p>
<p>The third dataset we will use is a CSV file with the country codes and names of the Arctic countries in the Arctic communities dataset. This dataset was created for educational purposes for this lesson based on the metadata of the Arctic communities dataset and the country names in Natural Earth’s dataset. It can be accessed <a href="">here</a>.</p>
</section>
<section id="import-data" class="level2">
<h2 class="anchored" data-anchor-id="import-data">Import data</h2>
<p>We will first import the countries shapefile and adapt it for wrangling purposes:</p>
<div id="99765640" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Import countries polygons</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>fp <span class="op">=</span> os.path.join(<span class="st">'data'</span>, <span class="st">'ne_50m_admin_0_countries'</span>, <span class="st">'ne_50m_admin_0_countries.shp'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> gpd.read_file(fp)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Simplify column names</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>countries.columns <span class="op">=</span> countries.columns.<span class="bu">str</span>.lower()</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Select columns for analysis</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> countries[[<span class="st">'admin'</span>, <span class="st">'type'</span>, <span class="st">'geometry'</span>]]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>countries.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">admin</th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Zimbabwe</td>
<td>Sovereign country</td>
<td>POLYGON ((31.28789 -22.40205, 31.19727 -22.344...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Zambia</td>
<td>Sovereign country</td>
<td>POLYGON ((30.39609 -15.64307, 30.25068 -15.643...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Yemen</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((53.08564 16.64839, 52.58145 16...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Vietnam</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((104.06396 10.39082, 104.08301 ...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Venezuela</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((-60.82119 9.13838, -60.94141 9...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="0710fc8d" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick view</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>countries.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lesson-12-merge-data_files/figure-html/cell-4-output-1.png" width="578" height="293" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Next, we import the Arctic communities data. Similar to how we previously used <code>pandas.read_csv()</code>, we can read in the Arctic communities GeoJSON data directly from the data repository using <code>geopandas.read_file()</code>:</p>
<div id="5a14e2bf" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Arctic communities data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>URL <span class="op">=</span> <span class="st">'https://cn.dataone.org/cn/v2/resolve/urn%3Auuid%3Aed7718ae-fb0d-43dd-9270-fbfe80bfc7a4'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>communities <span class="op">=</span> gpd.read_file(URL)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>communities.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">population</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">geoname-id</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Udomlya</td>
<td>32373</td>
<td>RU</td>
<td>452949</td>
<td>POINT (34.99250 57.87944)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Valmiera</td>
<td>26963</td>
<td>LV</td>
<td>453754</td>
<td>POINT (25.42751 57.54108)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Ventspils</td>
<td>42644</td>
<td>LV</td>
<td>454310</td>
<td>POINT (21.57288 57.38988)</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Vec-Liepāja</td>
<td>85260</td>
<td>LV</td>
<td>454432</td>
<td>POINT (21.01667 56.53333)</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Tukums</td>
<td>18348</td>
<td>LV</td>
<td>454768</td>
<td>POINT (23.15528 56.96694)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The CRS of the <code>communities</code> is EPSG:4326. Remember all GeoJSON files are given in this CRS and all points are expressed in longitude and latitude units of decimal degrees.</p>
<div id="557e03cb" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(countries.crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>EPSG:4326</code></pre>
</div>
</div>
<p>Since the CRSs of our geospatila data match, it is easy to take a quick look at our communities data by plotting it on top of the countries dataframe:</p>
<div id="ccfbd4b3" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify CRSs match</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> countries.crs <span class="op">==</span> communities.crs</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>countries.plot(ax<span class="op">=</span>ax)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>communities.plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lesson-12-merge-data_files/figure-html/cell-7-output-1.png" width="403" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we import the country names and codes CSV:</p>
<div id="69387998" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>country_names <span class="op">=</span> pd.read_csv(os.path.join(<span class="st">'data'</span>,<span class="st">'country_names.csv'</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>country_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">admin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>RU</td>
<td>Russia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>LV</td>
<td>Latvia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>EE</td>
<td>Estonia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>LT</td>
<td>Lithuania</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>SE</td>
<td>Sweden</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>BY</td>
<td>Belarus</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>FI</td>
<td>Finland</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>NO</td>
<td>Norway</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>DK</td>
<td>Denmark</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>FO</td>
<td>Faroe Islands</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>IS</td>
<td>Iceland</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>GB</td>
<td>United Kingdom</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>AX</td>
<td>Aland Islands</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>GL</td>
<td>Greenland</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>US</td>
<td>United States of America</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>CA</td>
<td>Canada</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="arctic-communities-by-country" class="level2">
<h2 class="anchored" data-anchor-id="arctic-communities-by-country">Arctic communities by country</h2>
<p>Next, we want to calculate the number of Arctic communities by country.</p>
<div id="3e6710a6" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame with number of communities per country</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>n_comms <span class="op">=</span> (communities.groupby(<span class="st">'country'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                      .size()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                      .reset_index(name<span class="op">=</span><span class="st">'n_communities'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s break this down:</p>
<ul>
<li>We start with our <code>communities</code> dataframe and use <code>groupby('country')</code> to group by country code.</li>
<li>Then we use <a href="https://pandas.pydata.org/docs/reference/api/pandas.core.groupby.DataFrameGroupBy.size.html"><code>size()</code></a> as an aggregator function to calculate the size of each group.</li>
<li>The result of this operation is a <code>pandas.Series</code> indexed by the <code>country</code> values.</li>
<li>By resetting the index we transform the <code>pandas.Series</code> into a <code>pandas.DataFrame</code>, the index is now a column named <code>country</code> and the values of the series are named <code>n_communities</code>.</li>
</ul>
<div id="a6b45b00" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of Arctic communities per country</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>n_comms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">n_communities</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AX</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BY</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>CA</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>DK</td>
<td>72</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>EE</td>
<td>14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>FI</td>
<td>98</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>FO</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>GB</td>
<td>96</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>GL</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>IS</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>LT</td>
<td>26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>LV</td>
<td>25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>NO</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>RU</td>
<td>774</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SE</td>
<td>133</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>US</td>
<td>115</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="if-else-statements" class="level2">
<h2 class="anchored" data-anchor-id="if-else-statements"><code>if</code>-<code>else</code> statements</h2>
<p>Our goal is to merge the <code>n_comms</code> and the <code>countries</code> data frames. To merge two data frames they need to have at least one column in common. Currently our datasets do not have any columns in common:</p>
<div id="26a19852" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>(countries.columns).intersection(n_comms.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>set()</code></pre>
</div>
</div>
<p>The output <code>set()</code> represents the empty set. This might not be as informative, so let’s write a different information statement:</p>
<div id="c92ff7e1" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>common_columns <span class="op">=</span> <span class="bu">set</span>(countries.columns).intersection(n_comms.columns)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if there are any common columns</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(common_columns) <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Common columns: </span><span class="sc">{</span>common_columns<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"No common columns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No common columns</code></pre>
</div>
</div>
<p>Remember that an <code>if-else</code> statement is a control structure that allows code to make decisions: it checks a condition, and if that condition is true, it executes one block of code (the <code>if</code> block); if the condition is false, it executes a different block (the <code>else</code> block). This enables programs to respond differently depending on specific criteria or inputs.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check-in
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wrap up the previous code into a function called <code>check_common_columns</code> that prints a message depending of whether two data frames have common columns or not. Don’t forget to include a docstring! <!--

::: {#c26c9105 .cell execution_count=12}
``` {.python .cell-code}
def check_common_columns(df1, df2):
    """
    Prints a message depending whether df1 and df2 have columns in common

     Parameters:
    - df1: The first DataFrame.
    - df2: The second DataFrame.
    
    Returns:
    - A set of common column names. If no columns are common, returns an empty set.
    """

    common_columns = set(df1.columns).intersection(df2.columns)
    
    if common_columns:
        print(f"Common columns: {common_columns}")
    else:
        print("No common columns")
    
    return 
```
:::


--></p>
</div>
</div>
</section>
<section id="merging-data-frames" class="level2">
<h2 class="anchored" data-anchor-id="merging-data-frames">Merging data frames</h2>
<p>We can use the <code>country_names</code> data frame to add the names countries into the <code>n_comms</code> data which, in turn, will allow us to merge that data frame with the <code>country_names</code> data. To merge dataframes we can use the <a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html#pandas.merge"><code>pandas.merge()</code> function</a>. The basic syntax for it is:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>output_df <span class="op">=</span> pd.merge(left_df,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                     right_df, </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                     how <span class="op">=</span> type_of_join, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                     on <span class="op">=</span> column_to_join)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where</p>
<ul>
<li><code>output_df</code> is the dataframe resulting from the merge,</li>
<li><code>left_df</code> is the dataframe we have “on the left side”,</li>
<li><code>right_df</code> is the dataframe we have “on the right side”,</li>
<li><code>how</code> specifies the type of join between the left and right dataframes, (<a href="https://pandas.pydata.org/docs/reference/api/pandas.merge.html#pandas.merge">check the options here</a>), the default is to do an inner join,</li>
<li><code>on</code> specifies the column to join on, this column must be present in both our dataframes.</li>
</ul>
<p>When merging a <code>geopandas.GeoDataFrame</code> with a <code>pandas.DataFrame</code>, the <code>geopandas.GeoDataFrame</code> must be “on the left” to retain the geospatial information. Otherwise, the output will be a <code>pandas.DataFrame</code>.</p>
<p>So, we merge the <code>n_comms</code> and <code>country_names</code> data frames using a left join:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../book/images/merging_data/join-diagrams-left.png" class="img-fluid figure-img"></p>
<figcaption>Image source: Data Modeling Essentials, NCEAS Learning Hub <span class="citation" data-cites="do-linh_open_2023"><a href="#ref-do-linh_open_2023" role="doc-biblioref">[2]</a></span></figcaption>
</figure>
</div>
<div id="4bd1d49a" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>n_comms <span class="op">=</span> pd.merge(n_comms,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                   country_names,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                   how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                   on<span class="op">=</span><span class="st">'country'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>n_comms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">n_communities</th>
<th data-quarto-table-cell-role="th">admin</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AX</td>
<td>1</td>
<td>Aland Islands</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>BY</td>
<td>8</td>
<td>Belarus</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>CA</td>
<td>7</td>
<td>Canada</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>DK</td>
<td>72</td>
<td>Denmark</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>EE</td>
<td>14</td>
<td>Estonia</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>FI</td>
<td>98</td>
<td>Finland</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>FO</td>
<td>1</td>
<td>Faroe Islands</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>GB</td>
<td>96</td>
<td>United Kingdom</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>GL</td>
<td>1</td>
<td>Greenland</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>IS</td>
<td>5</td>
<td>Iceland</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>LT</td>
<td>26</td>
<td>Lithuania</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>LV</td>
<td>25</td>
<td>Latvia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>NO</td>
<td>48</td>
<td>Norway</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>RU</td>
<td>774</td>
<td>Russia</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>SE</td>
<td>133</td>
<td>Sweden</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>US</td>
<td>115</td>
<td>United States of America</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can reuse our function to check that <code>n_comms</code> and <code>countries</code> now have a common column on which we can merge them:</p>
<div id="7a51cb44" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>check_common_columns(n_comms, countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Common columns: {'admin'}</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check-in
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a new variable named <code>arctic_countries</code> which is the result of an inner join between our <code>countries</code> and <code>n_comms</code> dataframes. The inner joun will merge the subset of rows that have matches in both the left table and the right table.</p>
<p><img src="../../../book/images/merging_data/join-diagrams-inner.png" class="img-fluid" alt="Image source: Data Modeling Essentials, NCEAS Learning Hub [2]"> <!--

::: {#997ccc84 .cell execution_count=15}
``` {.python .cell-code}
# Merge data frames 
arctic_countries = pd.merge(countries,
                            n_comms,
                            how='inner',
                            on='admin')
# Update index
arctic_countries = arctic_countries.set_index('admin')
```
:::


--></p>
</div>
</div>
</section>
<section id="reviewing-results" class="level2">
<h2 class="anchored" data-anchor-id="reviewing-results">Reviewing results</h2>
<p>Notice that the row for Aland Islands is not present in the merged dataframe:</p>
<div id="b9923e5e" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>arctic_countries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">type</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">country</th>
<th data-quarto-table-cell-role="th">n_communities</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">admin</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">United States of America</td>
<td>Country</td>
<td>MULTIPOLYGON (((-132.74687 56.52568, -132.7576...</td>
<td>US</td>
<td>115</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">United Kingdom</td>
<td>Country</td>
<td>MULTIPOLYGON (((-2.66768 51.62300, -2.74214 51...</td>
<td>GB</td>
<td>96</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sweden</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((19.07646 57.83594, 18.99375 57...</td>
<td>SE</td>
<td>133</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Russia</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((145.88154 43.45952, 145.89561 ...</td>
<td>RU</td>
<td>774</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Norway</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((20.62217 69.03687, 20.49199 69...</td>
<td>NO</td>
<td>48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lithuania</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((20.95781 55.27891, 20.89980 55...</td>
<td>LT</td>
<td>26</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Latvia</td>
<td>Sovereign country</td>
<td>POLYGON ((26.59355 55.66753, 26.54287 55.67241...</td>
<td>LV</td>
<td>25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Iceland</td>
<td>Sovereign country</td>
<td>POLYGON ((-15.54312 66.22852, -15.42847 66.224...</td>
<td>IS</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Finland</td>
<td>Country</td>
<td>MULTIPOLYGON (((24.15547 65.80527, 24.04902 65...</td>
<td>FI</td>
<td>98</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Estonia</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((27.35195 57.52812, 27.32656 57...</td>
<td>EE</td>
<td>14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Greenland</td>
<td>Country</td>
<td>MULTIPOLYGON (((-29.95288 83.56484, -28.99199 ...</td>
<td>GL</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Faroe Islands</td>
<td>Dependency</td>
<td>MULTIPOLYGON (((-6.62319 61.80596, -6.64277 61...</td>
<td>FO</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Denmark</td>
<td>Country</td>
<td>MULTIPOLYGON (((12.56875 55.78506, 12.57119 55...</td>
<td>DK</td>
<td>72</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Canada</td>
<td>Sovereign country</td>
<td>MULTIPOLYGON (((-132.65552 54.12749, -132.5640...</td>
<td>CA</td>
<td>7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Belarus</td>
<td>Sovereign country</td>
<td>POLYGON ((31.76338 52.10107, 31.57373 52.10811...</td>
<td>BY</td>
<td>8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The <code>values</code> attribute of a data frame returns <em>all</em> the values in the data frame as an array. We can verify the value ‘Aland Islands’ was <em>nowhere</em> in our original countries dataframe like this:</p>
<div id="ae5a186e" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Aland Islands is nowhere in data frame</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">'Aland Islands'</span> <span class="kw">not</span> <span class="kw">in</span> countries.values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>True</code></pre>
</div>
</div>
<p>The Aland Islands is an autonomous region of Finland and there is one Arctic community registered in this region. We will directly add one to Finland to not lose this piece of data:</p>
<div id="dac63a39" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>arctic_countries.at[<span class="st">'Finland'</span>, <span class="st">'n_communities'</span>] <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choropleth-map" class="level2">
<h2 class="anchored" data-anchor-id="choropleth-map">Choropleth map</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Choropleth_map">choropleth map</a> is an efficient way to visualize aggregate data per region.</p>
<p>Making a choropleth map from our polygons <code>GeoDataFrame</code> is easy; we just need to specify the <code>column</code> parameter in <code>plot()</code> and make it equal to the column with the values we want to plot in each country:</p>
<div id="355d25d4" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>arctic_countries.plot(column<span class="op">=</span><span class="st">'n_communities'</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                      legend<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lesson-12-merge-data_files/figure-html/cell-20-output-1.png" width="542" height="389" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="reprojecting-1" class="level2">
<h2 class="anchored" data-anchor-id="reprojecting-1">Reprojecting</h2>
<p>Remember that CRSs reflect cultural views and even biases. Any map projection involves choices about which areas to emphasize, minimize, or distort, and those choices can influence how viewers perceive different regions. In our map, using the EPSG:4326 CRS is, among other things, mapping the Arctic regions as far apart, while they are actually near each other.</p>
<p><strong>Reprojecting</strong> means changing the coordinate reference system of your geospatial data. In our case, we will reproject the Alaska geo-dataframe to the CRS EPSG:3413. This CRS is a <em>projected</em> CRS, better suited for working with data from the Arctic region:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../../../book/images/lesson-12/epsg_3413.png" class="img-fluid figure-img"></p>
<figcaption>Source: <a href="https://spatialreference.org/ref/epsg/3413/">spatialreference.org</a></figcaption>
</figure>
</div>
<p>Changing CRSs in GeoPandas is very simple using the <code>to_crs()</code> method for <code>geopandas.GeoDataFrame</code>s. The general syntax is:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>updated_geodf <span class="op">=</span> geodf.to_crs(new_crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where:</p>
<ul>
<li><code>updated_geodf</code> is the output of the method, a new geodataframe (<code>to_crs()</code> does not work in place),</li>
<li><code>geodf</code> is the <code>geopandas.GeoDataFrame</code> we want to transform,</li>
<li><code>new_crs</code> the CRS we want to convert to, this is an object of type CRS or string representing the CRS (ex: <code>'epsg:3413'</code>).</li>
</ul>
<p>In our case:</p>
<div id="2358c27a" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject to CRS optimized for Arctic region</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>arctic_countries <span class="op">=</span> arctic_countries.to_crs(<span class="st">'epsg:3413'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now use the reprojected data to update our map:</p>
<div id="1fd3d04a" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the axis for a cleaner map</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create choropleth map of communities</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with refined color and edge style</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>arctic_countries.plot(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'n_communities'</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'PuBuGn'</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"0.6"</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    legend_kwds<span class="op">=</span>{</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"shrink"</span>: <span class="fl">0.7</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">"label"</span>: <span class="st">"Number of Arctic Communities"</span>,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"orientation"</span>: <span class="st">"horizontal"</span>,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pad"</span>: <span class="fl">0.05</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add title and subtitle for better context</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Distribution of Arctic Communities'</span>, fontsize<span class="op">=</span><span class="dv">18</span>, weight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="lesson-12-merge-data_files/figure-html/cell-22-output-1.png" width="488" height="496" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Although the new projection clearly improves the presentation of the data, there are still issues with this plot! Mainly, the entire United States territory is in it, when we should only have Alaska. <strong>In our next lesson we will review startegies to clip and subset vector data and return to this plot in our discussion section.</strong></p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-brook_approximate_2023" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">M. Brook, <span>“Approximate <span>Arctic</span> <span>Communities</span> and <span>Populations</span>, (latitude <span>&gt;</span>= 55, 2022).”</span> Arctic Data Center, 2023. doi: <a href="https://doi.org/10.18739/A28S4JQ80">10.18739/A28S4JQ80</a>. Available: <a href="https://arcticdata.io/catalog/view/doi:10.18739/A28S4JQ80">https://arcticdata.io/catalog/view/doi:10.18739/A28S4JQ80</a>. [Accessed: Nov. 03, 2024]</div>
</div>
<div id="ref-do-linh_open_2023" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">H. Do-Linh, C. Galaz García, M. B. Jones, and C. Vargas Poulsen, <em>Open <span>Science</span> <span>Synthesis</span> training <span>Week</span> 1. <span>NCEAS</span> <span>Learning</span> <span>Hub</span> &amp; <span>Delta</span> <span>Stewardship</span> <span>Council</span>.</em> 2023. Available: <a href="https://learning.nceas.ucsb.edu/2023-06-delta/">https://learning.nceas.ucsb.edu/2023-06-delta/</a></div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This work is licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC Attribution-NonCommercial 4.0 International (CC BY-NC 4.0) License</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This website is built with <a href="https://quarto.org/">Quarto</a> and <a href="https://github.com/MEDS-eds-220/MEDS-eds-220-course">GitHub pages</a>.</p>
</div>
  </div>
</footer>




</body></html>